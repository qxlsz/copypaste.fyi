<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Copy Paste</title>
    <style>
        :root {
            --page-gradient: linear-gradient(135deg, #1e3a8a 0%, #312e81 45%, #7c3aed 100%);
            --background: #f4f5fb;
            --surface: rgba(255, 255, 255, 0.88);
            --surface-strong: rgba(255, 255, 255, 0.96);
            --border: rgba(226, 232, 240, 0.7);
            --text: #0f172a;
            --muted: #64748b;
            --primary: #6366f1;
            --primary-hover: #4f46e5;
            --accent: #22d3ee;
            --accent-hover: #0ea5e9;
            --secondary: rgba(148, 163, 184, 0.16);
            --error: #ef4444;
            --success: #14b8a6;
            --code-bg: #0f172a;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--page-gradient);
            color: var(--text);
            display: flex;
            flex-direction: column;
        }

        header {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem 2rem;
            align-items: center;
            justify-content: space-between;
            padding: clamp(1.75rem, 5vw, 3rem) clamp(1.25rem, 4vw, 3.5rem) clamp(1.5rem, 3vw, 2.5rem);
            color: #fff;
        }

        header h1 {
            margin: 0;
            font-size: clamp(2.25rem, 3vw, 3rem);
            letter-spacing: -0.03em;
            text-shadow: 0 20px 45px rgba(15, 23, 42, 0.35);
        }

        header .tagline {
            margin: 0;
            color: rgba(226, 232, 240, 0.9);
            font-size: 1rem;
        }

        .controls-top {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }

        main.workspace {
            flex: 1;
            width: min(1460px, 98vw);
            margin: 0 auto;
            padding: 0 clamp(1.25rem, 2vw, 2rem) clamp(2.5rem, 4vw, 3.5rem);
            display: grid;
            grid-template-columns: minmax(0, 1fr) 360px;
            gap: clamp(1.85rem, 4vw, 3rem);
            align-items: start;
        }

        @media (max-width: 1180px) {
            main.workspace {
                grid-template-columns: minmax(0, 1fr);
            }
        }

        .editor-panel {
            backdrop-filter: blur(20px);
            background: rgba(248, 250, 252, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.2);
            border-radius: 1.35rem;
            padding: clamp(2rem, 3vw, 3rem);
            box-shadow: 0 25px 65px -26px rgba(15, 23, 42, 0.5);
            display: flex;
            flex-direction: column;
            gap: 1.75rem;
            min-height: 75vh;
        }

        .side-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .status-card {
            backdrop-filter: blur(12px);
            background: rgba(15, 23, 42, 0.72);
            border-radius: 1rem;
            padding: 1.6rem;
            color: #f8fafc;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            box-shadow: 0 18px 45px -24px rgba(15, 23, 42, 0.55);
        }

        .share-card {
            backdrop-filter: blur(16px);
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(148, 163, 184, 0.18);
            border-radius: 1rem;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            box-shadow: 0 20px 45px -28px rgba(15, 23, 42, 0.28);
        }

        .share-card h2 {
            margin: 0;
            font-size: 1.15rem;
            color: #0f172a;
        }

        .toggle-field label {
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }

        .toggle-field input[type="checkbox"] {
            width: 1.1rem;
            height: 1.1rem;
            accent-color: var(--primary);
        }

        label {
            font-weight: 600;
        }

        textarea {
            width: 100%;
            flex: 1;
            min-height: 62vh;
            resize: vertical;
            padding: clamp(1.1rem, 2.2vw, 1.5rem);
            border-radius: 1.1rem;
            border: 1px solid rgba(148, 163, 184, 0.38);
            background: rgba(255, 255, 255, 0.96);
            font-family: "JetBrains Mono", SFMono-Regular, Consolas, "Liberation Mono", Menlo, monospace;
            font-size: clamp(1.02rem, 1.15vw, 1.18rem);
            color: var(--text);
            line-height: 1.75;
            box-shadow: inset 0 1px 6px rgba(15, 23, 42, 0.06);
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
        }

        select,
        input[type="number"],
        input[type="password"],
        input[type="text"] {
            width: 100%;
            padding: 0.65rem 0.85rem;
            font-size: 1rem;
            border-radius: 0.65rem;
            border: 1px solid var(--border);
            background: #fff;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        select:focus,
        input[type="number"]:focus,
        input[type="password"]:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.18);
        }

        .controls-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            flex-wrap: wrap;
            padding-top: 1rem;
            border-top: 1px solid rgba(148, 163, 184, 0.22);
        }

        button {
            background: var(--primary);
            color: #fff;
            padding: 0.75rem 1.6rem;
            border-radius: 999px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease;
        }

        button:hover {
            background: var(--primary-hover);
            box-shadow: 0 12px 24px -18px rgba(79, 70, 229, 0.8);
        }

        button:active {
            transform: translateY(1px);
        }

        button.secondary {
            background: rgba(99, 102, 241, 0.12);
            color: var(--primary);
        }

        button.secondary:hover {
            background: rgba(99, 102, 241, 0.22);
        }

        .status {
            color: var(--muted);
            font-size: 0.95rem;
        }

        .status-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.25rem 0.7rem;
            font-size: 0.8rem;
            border-radius: 999px;
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
        }

        .status-pill.status-danger {
            background: rgba(239, 68, 68, 0.12);
            color: var(--error);
        }

        .error,
        .success {
            margin-top: 1rem;
            padding: 0.9rem 1.1rem;
            border-radius: 0.85rem;
            display: none;
            border: 1px solid transparent;
        }

        .error {
            border-color: rgba(220, 38, 38, 0.2);
            background: rgba(220, 38, 38, 0.08);
            color: var(--error);
        }

        .success {
            border-color: rgba(15, 118, 110, 0.2);
            background: rgba(13, 148, 136, 0.08);
            color: var(--success);
        }

        .result {
            margin-top: 1.75rem;
            padding: 1.5rem;
            border-radius: 1rem;
            border: 1px solid rgba(148, 163, 184, 0.25);
            background: var(--surface-strong);
            display: none;
            box-shadow: 0 14px 40px -32px rgba(15, 23, 42, 0.7);
        }

        .result a {
            color: var(--primary);
            text-decoration: none;
            word-break: break-all;
        }

        .result a:hover {
            text-decoration: underline;
        }

        .meta-note {
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--muted);
        }

        .meta-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--muted);
        }

        .ghost {
            background: rgba(99, 102, 241, 0.08);
            border: none;
            color: var(--primary);
            font-weight: 600;
            cursor: pointer;
            padding: 0.45rem 0.85rem;
            border-radius: 999px;
        }

        .ghost:hover {
            background: rgba(99, 102, 241, 0.16);
        }

        footer {
            text-align: center;
            color: var(--muted);
            font-size: 0.9rem;
            padding: 1.5rem;
            margin-top: auto;
        }

        .share-actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            margin-top: 1rem;
        }

        .share-actions button {
            background: rgba(15, 23, 42, 0.06);
            color: var(--text);
        }

        .share-actions button:hover {
            background: rgba(15, 23, 42, 0.12);
        }

        .qr-card {
            margin-top: 1.2rem;
            padding: 1rem;
            border-radius: 0.9rem;
            border: 1px dashed rgba(148, 163, 184, 0.45);
            background: rgba(241, 245, 249, 0.55);
            display: flex;
            justify-content: center;
        }

        .hidden {
            display: none !important;
        }

        .key-strength {
            margin-top: 0.4rem;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .key-strength.weak {
            color: #f97316;
        }

        .key-strength.medium {
            color: #facc15;
        }

        .key-strength.strong {
            color: var(--success);
        }

        .key-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-top: 0.6rem;
        }

        .key-input-row {
            display: flex;
            gap: 0.6rem;
            align-items: center;
        }

        .key-input-row input {
            flex: 1;
        }

        .controls-top .field {
            margin-bottom: 0;
            min-width: 150px;
        }

        .meta-column {
            max-width: 320px;
            color: var(--muted);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header>
        <div>
            <h1>Copy Paste</h1>
            <p class="tagline">Pasteboard for builders. Encrypt, share, done.</p>
        </div>
        <div class="controls-top">
            <div class="field">
                <label for="format">Format</label>
                <select id="format">
                    <option value="plain_text">Plain text</option>
                    <option value="markdown">Markdown</option>
                    <option value="code">Code block (generic)</option>
                    <option value="json">JSON (pretty print)</option>
                    <option value="go">Go</option>
                    <option value="cpp">C++</option>
                    <option value="kotlin">Kotlin</option>
                    <option value="java">Java</option>
                </select>
            </div>
            <div class="field">
                <label for="retention">Retention</label>
                <select id="retention">
                    <option value="0">No expiry</option>
                    <option value="10">10 minutes</option>
                    <option value="60">1 hour</option>
                    <option value="1440">24 hours</option>
                    <option value="10080">7 days</option>
                    <option value="43200" selected>30 days</option>
                </select>
            </div>
            <div class="field">
                <label for="encryption-mode">Encryption</label>
                <select id="encryption-mode">
                    <option value="none">None</option>
                    <option value="aes256_gcm">AES-256-GCM</option>
                    <option value="chacha20_poly1305">ChaCha20-Poly1305</option>
                    <option value="xchacha20_poly1305">XChaCha20-Poly1305</option>
                </select>
            </div>
            <div class="field toggle-field">
                <label for="burn-after-reading">
                    <input type="checkbox" id="burn-after-reading" />
                    Burn after reading
                </label>
            </div>
        </div>
    </header>

    <main class="workspace">
        <section class="editor-panel">
            <div class="field">
                <label for="content">Your text</label>
                <textarea id="content" placeholder="Type or paste your text here..."></textarea>
            </div>

            <div class="field" id="encryption-key-field" style="display:none;">
                <label for="encryption-key">Encryption key</label>
                <div class="key-input-row">
                    <input type="text" id="encryption-key" placeholder="Enter or generate a passphrase" autocomplete="off" />
                    <button class="ghost" id="toggle-key-visibility" type="button">Hide key</button>
                </div>
                <div class="key-controls">
                    <button class="ghost" id="generate-key" type="button">Geek passphrase</button>
                    <button class="ghost secondary" id="generate-emoji" type="button">Emoji combo</button>
                    <button class="ghost secondary" id="generate-dice" type="button">Diceware blend</button>
                </div>
                <div class="key-strength hidden" id="key-strength"></div>
                <div class="meta-note">Key is never stored. Share it separately.</div>
            </div>

            <div class="controls-footer">
                <div class="actions">
                    <button id="create">Create paste</button>
                    <span class="status" id="status">Ready</span>
                </div>
                <div class="meta-column">
                    <div class="meta-note">Burn deletes after the first view. Keys never touch the server.</div>
                </div>
            </div>

            <div id="success" class="success"></div>
            <div id="error" class="error"></div>
        </section>

        <aside class="side-panel">
            <div class="status-card">
                <div class="meta-row">
                    <div>
                        <strong>Status</strong>
                        <div class="meta-note" id="status-help">Ready to create a paste.</div>
                    </div>
                    <span class="status-pill" id="result-status">Idle</span>
                </div>
                <div>
                    <label class="meta-note" for="encryption-mode">Encryption</label>
                    <div class="summary-line" id="summary-encryption">No encryption selected.</div>
                </div>
                <div>
                    <label class="meta-note" for="retention">Retention</label>
                    <div class="summary-line" id="summary-retention">No expiry</div>
                </div>
            </div>

            <div class="share-card" id="result-card" style="display:none;">
                <h2>Share</h2>
                <p class="meta-note">Copy or send the link directly. Keep passphrases off-channel.</p>
                <a id="paste-url" href="#" target="_blank" rel="noopener"></a>
                <div class="share-actions">
                    <button class="secondary" id="share-copy" type="button">Copy link</button>
                    <button class="secondary" id="share-email" type="button">Email</button>
                    <button class="secondary" id="share-tweet" type="button">Tweet</button>
                    <button class="secondary" id="share-slack" type="button">Slack</button>
                    <button class="secondary" id="share-qr" type="button">QR code</button>
                    <button class="secondary hidden" id="share-native" type="button">System share</button>
                </div>
                <div class="qr-card hidden" id="qr-card">
                    <img id="qr-image" alt="QR code preview" width="160" height="160" />
                </div>
            </div>

        </aside>
    </main>

    <footer>
        Pastes live in memory only. Restarting the server clears everything.
    </footer>

    <script>
        const textarea = document.getElementById('content');
        const formatSelect = document.getElementById('format');
        const retentionSelect = document.getElementById('retention');
        const encryptionMode = document.getElementById('encryption-mode');
        const encryptionKeyField = document.getElementById('encryption-key-field');
        const encryptionKeyInput = document.getElementById('encryption-key');
        const generateKeyButton = document.getElementById('generate-key');

        const createButton = document.getElementById('create');
        const status = document.getElementById('status');
        const errorBox = document.getElementById('error');
        const successBox = document.getElementById('success');
        const resultCard = document.getElementById('result-card');
        const pasteLink = document.getElementById('paste-url');
        const resultStatus = document.getElementById('result-status');
        const shareCopy = document.getElementById('share-copy');
        const shareEmail = document.getElementById('share-email');
        const shareTweet = document.getElementById('share-tweet');
        const shareSlack = document.getElementById('share-slack');
        const shareQr = document.getElementById('share-qr');
        const shareNative = document.getElementById('share-native');
        const qrCard = document.getElementById('qr-card');
        const qrImage = document.getElementById('qr-image');
        const toggleKeyVisibility = document.getElementById('toggle-key-visibility');
        const keyStrengthIndicator = document.getElementById('key-strength');
        const generateEmojiButton = document.getElementById('generate-emoji');
        const generateDiceButton = document.getElementById('generate-dice');
        const burnAfterReading = document.getElementById('burn-after-reading');

        function resetAlerts() {
            errorBox.style.display = 'none';
            successBox.style.display = 'none';
        }

        function showError(message) {
            errorBox.textContent = message;
            errorBox.style.display = 'block';
            successBox.style.display = 'none';
        }

        function showSuccess(message) {
            successBox.textContent = message;
            successBox.style.display = 'block';
            errorBox.style.display = 'none';
        }

        encryptionMode.addEventListener('change', () => {
            const mode = encryptionMode.value;
            if (mode === 'aes256_gcm' || mode === 'chacha20_poly1305' || mode === 'xchacha20_poly1305') {
                encryptionKeyField.style.display = 'block';
            } else {
                encryptionKeyField.style.display = 'none';
                encryptionKeyInput.value = '';
                keyStrengthIndicator.classList.add('hidden');
            }
        });

        const cyberWords = [
            'quantum', 'neon', 'flux', 'cipher', 'daemon', 'matrix', 'entropy', 'glitch',
            'wormhole', 'subroutine', 'cosmos', 'overclock', 'phase', 'lambda', 'phoenix',
            'hyperdrive', 'tachyon', 'synthwave', 'bytecode', 'singularity', 'nanobot', 'astral'
        ];

        function generateGeekKey() {
            const pick = () => cyberWords[Math.floor(Math.random() * cyberWords.length)];
            const segments = [pick(), pick(), pick(), Math.floor(Math.random() * 9000 + 1000)];
            return segments.join('-');
        }

        if (generateKeyButton) {
            generateKeyButton.addEventListener('click', () => {
                const key = generateGeekKey();
                encryptionKeyInput.value = key;
                updateKeyStrength(key);
                ensureKeyVisible();
            });
        }

        const emojiParts = ['🚀', '🛰️', '🧠', '🦾', '🧬', '🛸', '🪐', '🔒', '⚡', '💾', '🧲', '🥷'];
        const emojiAdjectives = ['neon', 'cyber', 'holo', 'quantum', 'proto', 'retro', 'plasma'];
        const emojiNouns = ['matrix', 'kernel', 'cipher', 'drone', 'avatar', 'daemon', 'gateway'];

        function generateEmojiCombo() {
            const pick = (arr) => arr[Math.floor(Math.random() * arr.length)];
            return `${pick(emojiParts)}-${pick(emojiAdjectives)}-${pick(emojiNouns)}-${pick(emojiParts)}`;
        }

        if (generateEmojiButton) {
            generateEmojiButton.addEventListener('click', () => {
                const key = generateEmojiCombo();
                encryptionKeyInput.value = key;
                updateKeyStrength(key);
                ensureKeyVisible();
            });
        }

        const dicewareWords = [
            'anode','binary','cobalt','delta','entropy','flux','geode','helium','ion','joule','kepler','lumen','neutrino','omega','photon','qubit','raster','synapse','tachyon','vector','warp','xenon','yotta','zephyr'
        ];

        function generateDicewareBlend() {
            const pick = () => dicewareWords[Math.floor(Math.random() * dicewareWords.length)];
            const number = Math.floor(Math.random() * 900 + 100);
            return `${pick()}-${pick()}-${pick()}-${number}`;
        }

        if (generateDiceButton) {
            generateDiceButton.addEventListener('click', () => {
                const key = generateDicewareBlend();
                encryptionKeyInput.value = key;
                updateKeyStrength(key);
                ensureKeyVisible();
            });
        }

        if (toggleKeyVisibility) {
            toggleKeyVisibility.addEventListener('click', () => {
                if (encryptionKeyInput.type === 'text') {
                    encryptionKeyInput.type = 'password';
                    toggleKeyVisibility.textContent = 'Show key';
                } else {
                    encryptionKeyInput.type = 'text';
                    toggleKeyVisibility.textContent = 'Hide key';
                }
            });
        }

        function ensureKeyVisible() {
            if (encryptionKeyInput.type !== 'text') {
                encryptionKeyInput.type = 'text';
                toggleKeyVisibility.textContent = 'Hide key';
            }
        }

        function updateKeyStrength(key) {
            if (!keyStrengthIndicator) return;
            const strength = assessKeyStrength(key);
            keyStrengthIndicator.textContent = `Key strength: ${strength.label}`;
            keyStrengthIndicator.className = `key-strength ${strength.className}`;
            keyStrengthIndicator.classList.remove('hidden');
        }

        function assessKeyStrength(key) {
            let score = 0;
            if (key.length >= 16) score += 1;
            if (/[0-9]/.test(key)) score += 1;
            if (/[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?~`]/.test(key)) score += 1;
            if (/[A-Z]/.test(key) && /[a-z]/.test(key)) score += 1;
            if (/\p{Emoji}/u.test(key)) score += 1;

            if (score >= 4) return { label: 'strong', className: 'strong' };
            if (score >= 2) return { label: 'medium', className: 'medium' };
            return { label: 'weak', className: 'weak' };
        }

        async function createPaste() {
            const content = textarea.value.trim();
            if (!content) {
                showError('Please enter some text to create a paste.');
                resultCard.style.display = 'none';
                return;
            }

            const format = formatSelect.value;
            const retention = parseInt(retentionSelect.value, 10);
            const encryption = encryptionMode.value;
            const encryptionKey = encryptionKeyInput.value.trim();
            const burn = burnAfterReading?.checked ?? false;

            if ((encryption === 'aes256_gcm' || encryption === 'xchacha20_poly1305') && !encryptionKey) {
                showError('Provide an encryption key or disable encryption.');
                resultCard.style.display = 'none';
                return;
            }

            resetAlerts();
            status.textContent = 'Saving...';
            createButton.disabled = true;

            const payload = {
                content,
                format,
                retention_minutes: retention || undefined,
                encryption: encryption !== 'none'
                    ? { algorithm: encryption, key: encryptionKey }
                    : undefined,
            };

            if (burn) {
                payload.burn_after_reading = true;
            }

            try {
                const response = await fetch('/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });

                if (!response.ok) {
                    throw new Error(`Server returned ${response.status}`);
                }

                const path = (await response.text()).trim();
                if (!path) {
                    throw new Error('Server returned an empty response');
                }

                const fullUrl = new URL(path, window.location.origin).toString();
                const shareableUrl = buildShareLink(fullUrl, encryptionKey);
                pasteLink.textContent = shareableUrl;
                pasteLink.href = shareableUrl;
                resultCard.style.display = 'block';
                qrCard.classList.add('hidden');
                status.textContent = 'Link ready';
                resultStatus.classList.remove('status-danger');
                statusHelp.textContent = 'Share the link or copy it to your clipboard.';
                if (burn) {
                    resultStatus.textContent = 'One-time link';
                    resultStatus.classList.add('status-danger');
                    summaryRetention.textContent = 'One-time, burns on view';
                } else if (encryption !== 'none') {
                    resultStatus.textContent = 'Key required';
                    resultStatus.classList.add('status-danger');
                    summaryRetention.textContent = retentionLabel(retention);
                } else {
                    resultStatus.textContent = 'Public paste';
                    summaryRetention.textContent = retentionLabel(retention);
                }
                summaryEncryption.textContent = encryptionSummary(encryption);
                textarea.value = '';

                const clipboardMessage = burn ? 'One-time link copied to clipboard' : 'Link copied to clipboard';
                const createdMessage = burn ? 'One-time paste created. Save the link!' : 'Paste created successfully';
                if (navigator.clipboard?.writeText) {
                    try {
                        await navigator.clipboard.writeText(shareableUrl);
                        showSuccess(clipboardMessage);
                    } catch (_) {
                        showSuccess(createdMessage);
                    }
                } else {
                    showSuccess(createdMessage);
                }
            } catch (err) {
                showError(err.message || 'Something went wrong. Please try again.');
                status.textContent = 'Something went wrong';
                resultCard.style.display = 'none';
            } finally {
                createButton.disabled = false;
            }
        }

        createButton.addEventListener('click', createPaste);
        textarea.addEventListener('keydown', (event) => {
            if ((event.metaKey || event.ctrlKey) && event.key === 'Enter') {
                createPaste();
            }
        });
        textarea.addEventListener('input', () => {
            resetAlerts();
            status.textContent = 'Ready';
        });

        encryptionKeyInput.addEventListener('input', () => {
            const key = encryptionKeyInput.value.trim();
            if (key) {
                updateKeyStrength(key);
            } else if (keyStrengthIndicator) {
                keyStrengthIndicator.classList.add('hidden');
            }
        });

        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
                showSuccess('Link copied to clipboard');
            } catch (err) {
                showError('Unable to copy automatically. Copy the link manually.');
            }
        }

        function buildShareLink(baseUrl, key) {
            if (!key) return baseUrl;
            const separator = baseUrl.includes('?') ? '&' : '?';
            return `${baseUrl}${separator}key=${encodeURIComponent(key)}`;
        }

        if (shareCopy) {
            shareCopy.addEventListener('click', async () => {
                const link = pasteLink.href;
                if (!link) {
                    showError('Create a paste before sharing.');
                    return;
                }
                await copyToClipboard(link);
            });
        }

        if (shareEmail) {
            shareEmail.addEventListener('click', () => {
                const link = pasteLink.href;
                if (!link) {
                    showError('Create a paste before sharing.');
                    return;
                }
                const subject = encodeURIComponent('copypaste.fyi share');
                const body = encodeURIComponent(`Here is the paste link: ${link}`);
                window.open(`mailto:?subject=${subject}&body=${body}`, '_blank');
            });
        }

        if (shareTweet) {
            shareTweet.addEventListener('click', () => {
                const link = pasteLink.href;
                if (!link) {
                    showError('Create a paste before sharing.');
                    return;
                }
                const text = encodeURIComponent('Sharing a paste via copypaste.fyi');
                window.open(`https://x.com/intent/tweet?text=${text}&url=${encodeURIComponent(link)}`, '_blank');
            });
        }

        if (shareSlack) {
            shareSlack.addEventListener('click', () => {
                const link = pasteLink.href;
                if (!link) {
                    showError('Create a paste before sharing.');
                    return;
                }
                const text = encodeURIComponent(`Paste drop: ${link}`);
                window.open(`https://slack.com/app_redirect?channel=general&message=${text}`, '_blank');
            });
        }

        function makeQr(link) {
            const endpoint = 'https://api.qrserver.com/v1/create-qr-code/';
            return `${endpoint}?size=160x160&data=${encodeURIComponent(link)}`;
        }

        if (shareQr) {
            shareQr.addEventListener('click', () => {
                const link = pasteLink.href;
                if (!link) {
                    showError('Create a paste before sharing.');
                    return;
                }
                qrImage.src = makeQr(link);
                qrCard.classList.remove('hidden');
                showSuccess('QR code ready below.');
            });
        }

        if (navigator.share) {
            shareNative.classList.remove('hidden');
            shareNative.addEventListener('click', async () => {
                const link = pasteLink.href;
                if (!link) {
                    showError('Create a paste before sharing.');
                    return;
                }
                try {
                    await navigator.share({ title: 'copypaste.fyi', text: 'Check out this paste', url: link });
                } catch (err) {
                    showError('System share canceled or unsupported.');
                }
            });
        }

    </script>
</body>
</html>
